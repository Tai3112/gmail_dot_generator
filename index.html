<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Gmail Dot Generator</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 12px 30px rgba(0,0,0,0.06);
    }
    h1 {
      font-size: 22px;
      margin-bottom: 8px;
    }
    p {
      margin-top: 0;
      color: #555;
      font-size: 14px;
    }
    label {
      font-weight: 600;
      font-size: 14px;
    }
    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 10px 12px;
      margin-top: 6px;
      margin-bottom: 14px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 14px;
    }
    input[type="number"] {
      max-width: 150px;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: flex-end;
      margin-bottom: 16px;
    }
    .row > div {
      flex: 1;
      min-width: 200px;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 10px 18px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-right: 8px;
      margin-top: 4px;
      background: #1877f2;
      color: #fff;
      box-shadow: 0 4px 10px rgba(24, 119, 242, 0.25);
      transition: transform .08s ease, box-shadow .08s ease, background .15s ease;
    }
    button.secondary {
      background: #e4e6eb;
      color: #111;
      box-shadow: none;
    }
    button.download {
      background: #00a86b;
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 14px rgba(24, 119, 242, 0.35);
    }
    button.secondary:hover {
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
    }
    button.download:hover {
      box-shadow: 0 6px 14px rgba(0, 168, 107, 0.35);
    }
    .warning {
      font-size: 12px;
      color: #d9534f;
      margin-top: -8px;
      margin-bottom: 10px;
    }
    .badge {
      display: inline-block;
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 999px;
      background: #e7f3ff;
      color: #1877f2;
      margin-left: 4px;
    }
    #resultInfo {
      font-size: 13px;
      margin-top: 10px;
      margin-bottom: 4px;
      color: #444;
    }
    textarea {
      width: 100%;
      min-height: 260px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #ddd;
      font-size: 13px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      resize: vertical;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Gmail Dot Generator</h1>
    <p>T·∫°o c√°c bi·∫øn th·ªÉ email Gmail b·∫±ng c√°ch ch√®n th√™m d·∫•u ch·∫•m v√†o ph·∫ßn username.<br>
       Gmail s·∫Ω b·ªè qua d·∫•u ch·∫•m ƒë·ªëi v·ªõi <strong>@gmail.com</strong> v√† <strong>@googlemail.com</strong>.</p>

    <label for="emailInput">Email g·ªëc (v√≠ d·ª•: <code>taikhobmt123@gmail.com</code>)</label>
    <input type="text" id="emailInput" placeholder="nh·∫≠p email g·ªëc c·ªßa b·∫°n..." />

    <div class="warning">
      ‚ö† H·ªá th·ªëng s·∫Ω t·ª± b·ªè d·∫•u ch·∫•m trong ph·∫ßn username tr∆∞·ªõc khi sinh bi·∫øn th·ªÉ.
    </div>

    <div class="row">
      <div>
        <label for="randomCount">S·ªë bi·∫øn th·ªÉ ng·∫´u nhi√™n</label>
        <input type="number" id="randomCount" min="1" max="1000" value="20" />
      </div>
      <div>
        <span style="font-size:13px;">T·ªëi ƒëa khi sinh t·∫•t c·∫£:
          <span class="badge" id="maxAllLabel">‚Äî</span>
        </span><br>
        <small style="font-size:11px;color:#777;">
          S·ªë tr∆∞·ªùng h·ª£p = 2<sup>(n - 1)</sup> v·ªõi n l√† ƒë·ªô d√†i username. M·∫∑c ƒë·ªãnh gi·ªõi h·∫°n 1024 ƒë·ªÉ tr√°nh qu√° n·∫∑ng.
        </small>
      </div>
    </div>

    <button id="btnRandom">Sinh ng·∫´u nhi√™n</button>
    <button id="btnAll" class="secondary">Sinh t·∫•t c·∫£ (gi·ªõi h·∫°n)</button>
    <button id="btnClear" class="secondary">Xo√° k·∫øt qu·∫£</button>
    <button id="btnDownload" class="download">T·∫£i xu·ªëng .txt</button>

    <div id="resultInfo"></div>
    <textarea id="output" placeholder="K·∫øt qu·∫£ s·∫Ω xu·∫•t hi·ªán ·ªü ƒë√¢y, m·ªói email tr√™n 1 d√≤ng..."></textarea>
  </div>

  <script>
    function parseEmail(raw) {
      raw = raw.trim();
      const idx = raw.indexOf("@");
      if (idx === -1) return null;
      const local = raw.slice(0, idx);
      const domain = raw.slice(idx + 1).toLowerCase();
      if (!local) return null;
      return { local, domain };
    }

    function cleanLocal(local) {
      // B·ªè c√°c d·∫•u ch·∫•m trong username
      return local.replace(/\./g, "");
    }

    // Sinh T·∫§T C·∫¢ bi·∫øn th·ªÉ (c√≥ gi·ªõi h·∫°n)
    function generateAllVariants(local, maxCount) {
      const n = local.length;
      if (n === 0) return [];
      if (n === 1) return [local];

      const positions = n - 1;
      const total = 1 << positions; // 2^(n-1)
      const limit = Math.min(total, maxCount);

      const res = [];
      for (let mask = 0; mask < limit; mask++) {
        let s = local[0];
        for (let i = 0; i < positions; i++) {
          if (mask & (1 << i)) s += ".";
          s += local[i + 1];
        }
        res.push(s);
      }
      return res;
    }

    // Sinh ng·∫´u nhi√™n kh√¥ng tr√πng l·∫∑p
    function generateRandomVariants(local, count) {
      const n = local.length;
      if (n === 0) return [];
      if (n === 1) return [local];

      const positions = n - 1;
      const total = 1 << positions;
      const realCount = Math.min(count, total);

      const seen = new Set();
      const res = [];

      while (res.length < realCount) {
        const mask = Math.floor(Math.random() * total);
        if (seen.has(mask)) continue;
        seen.add(mask);

        let s = local[0];
        for (let i = 0; i < positions; i++) {
          if (mask & (1 << i)) s += ".";
          s += local[i + 1];
        }
        res.push(s);
      }
      return res;
    }

    function updateMaxAllLabel() {
      const emailRaw = document.getElementById("emailInput").value;
      const parsed = parseEmail(emailRaw);
      const label = document.getElementById("maxAllLabel");
      if (!parsed) {
        label.textContent = "‚Äî";
        return;
      }
      const cleaned = cleanLocal(parsed.local);
      const n = cleaned.length;
      if (n <= 1) {
        label.textContent = "1 (n qu√° ng·∫Øn)";
      } else {
        const positions = n - 1;
        const total = 1 << positions;
        label.textContent = total > 100000 ? total.toLocaleString() + "+" : total.toLocaleString();
      }
    }

    document.getElementById("emailInput").addEventListener("input", updateMaxAllLabel);

    document.getElementById("btnRandom").addEventListener("click", () => {
      const raw = document.getElementById("emailInput").value;
      const parsed = parseEmail(raw);
      if (!parsed) {
        alert("Email kh√¥ng h·ª£p l·ªá. Vui l√≤ng nh·∫≠p d·∫°ng ten@gmail.com");
        return;
      }
      const cleanedLocal = cleanLocal(parsed.local);
      if (!cleanedLocal) {
        alert("Username tr·ªëng sau khi b·ªè d·∫•u ch·∫•m.");
        return;
      }
      const count = parseInt(document.getElementById("randomCount").value, 10) || 1;
      const locals = generateRandomVariants(cleanedLocal, count);
      const emails = locals.map(l => `${l}@${parsed.domain}`);
      document.getElementById("output").value = emails.join("\n");
      document.getElementById("resultInfo").textContent =
        `ƒê√£ sinh ${emails.length} bi·∫øn th·ªÉ ng·∫´u nhi√™n cho username "${cleanedLocal}".`;
    });

    document.getElementById("btnAll").addEventListener("click", () => {
      const raw = document.getElementById("emailInput").value;
      const parsed = parseEmail(raw);
      if (!parsed) {
        alert("Email kh√¥ng h·ª£p l·ªá. Vui l√≤ng nh·∫≠p d·∫°ng ten@gmail.com");
        return;
      }
      const cleanedLocal = cleanLocal(parsed.local);
      if (!cleanedLocal) {
        alert("Username tr·ªëng sau khi b·ªè d·∫•u ch·∫•m.");
        return;
      }
      const MAX_ALL = 1024; // b·∫°n c√≥ th·ªÉ tƒÉng nh∆∞ng c·∫©n th·∫≠n
      const locals = generateAllVariants(cleanedLocal, MAX_ALL);
      const emails = locals.map(l => `${l}@${parsed.domain}`);
      document.getElementById("output").value = emails.join("\n");
      document.getElementById("resultInfo").textContent =
        `ƒê√£ sinh ${emails.length} bi·∫øn th·ªÉ (gi·ªõi h·∫°n ${MAX_ALL}) cho username "${cleanedLocal}".`;
    });

    document.getElementById("btnClear").addEventListener("click", () => {
      document.getElementById("output").value = "";
      document.getElementById("resultInfo").textContent = "";
    });

    // üîΩ N√öT T·∫¢I XU·ªêNG .TXT
    document.getElementById("btnDownload").addEventListener("click", () => {
      const text = document.getElementById("output").value.trim();
      if (!text) {
        alert("Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ t·∫£i xu·ªëng. H√£y t·∫°o danh s√°ch email tr∆∞·ªõc.");
        return;
      }

      const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
      const url = URL.createObjectURL(blob);

      const a = document.createElement("a");
      a.href = url;

      // t√™n file: gmail-variants-YYYYMMDD-HHMMSS.txt
      const now = new Date();
      const pad = n => n.toString().padStart(2, "0");
      const fileName =
        "gmail-variants-" +
        now.getFullYear() +
        pad(now.getMonth() + 1) +
        pad(now.getDate()) + "-" +
        pad(now.getHours()) +
        pad(now.getMinutes()) +
        pad(now.getSeconds()) +
        ".txt";

      a.download = fileName;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });

    // c·∫≠p nh·∫≠t label ban ƒë·∫ßu
    updateMaxAllLabel();
  </script>
</body>
</html>
